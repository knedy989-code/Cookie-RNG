<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Cookie RNG: Infinite Crumb</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Cookie RNG">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: #f3f4f6;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        h1, h2, h3, .font-display { font-family: 'Fredoka', sans-serif; }
        
        /* Animations */
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-80px) scale(1.2); opacity: 0; } }
        @keyframes crumble { 0% { transform: translate(0, 0) rotate(0deg) scale(1); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) rotate(var(--r)) scale(0); opacity: 0; } }
        .animate-floatUp { animation: floatUp 0.8s ease-out forwards; }
        .animate-crumble { animation: crumble 0.6s ease-in forwards; }
        
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18",
            "react-dom/client": "https://esm.sh/react-dom@18/client",
            "lucide-react": "https://esm.sh/lucide-react"
        }
    }
    </script>

    <script type="module">
        import React, { useState, useEffect, useCallback, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import * as Lucide from 'lucide-react';

        // --- CONSTANTS & DATA ---
        const Rarity = {
            COMMON: 'Common', UNCOMMON: 'Uncommon', RARE: 'Rare', 
            ULTRA_RARE: 'Ultra Rare', EPIC: 'Epic', LEGENDARY: 'Legendary', 
            MYTHICAL: 'Mythical', ASCENDED: 'Ascended', DIVINE: 'Divine'
        };

        const RARITY_COLORS = {
            [Rarity.COMMON]: '#A0A0A0', [Rarity.UNCOMMON]: '#4ADE80', [Rarity.RARE]: '#60A5FA',
            [Rarity.ULTRA_RARE]: '#9333EA', [Rarity.EPIC]: '#C084FC', [Rarity.LEGENDARY]: '#FACC15',
            [Rarity.MYTHICAL]: '#F43F5E', [Rarity.ASCENDED]: '#22D3EE', [Rarity.DIVINE]: '#FFFFFF'
        };

        const UPGRADE_COSTS = {
            clickPower: (l) => Math.floor(50 * Math.pow(1.5, l)),
            luck: (l) => l < 5 ? [250, 500, 600, 700, 888, 1000][l] : Math.floor(1000 * Math.pow(1.5, l - 4)),
            autoClicker: (l) => l < 5 ? [300, 500, 680, 790, 1000][l] : Math.floor(1000 * Math.pow(1.5, l - 4))
        };

        // --- COMPONENTS ---
        
        const NavButton = ({ active, icon: Icon, label, onClick }) => (
            <button onClick={onClick} className={`flex flex-col items-center gap-1 transition-colors ${active ? 'text-amber-500' : 'text-zinc-500'}`}>
                <Icon size={24} />
                <span className="text-[10px] font-bold uppercase">{label}</span>
            </button>
        );

        const App = () => {
            const [gameState, setGameState] = useState({
                bits: 0,
                totalBitsEarned: 0,
                cookies: [],
                activeCookieId: null,
                upgrades: { clickPowerLevel: 1, luckLevel: 0, autoClickerLevel: 0 }
            });
            const [activeTab, setActiveTab] = useState('roll');

            // Load Game
            useEffect(() => {
                const saved = localStorage.getItem('cookie_rng_save');
                if (saved) setGameState(JSON.parse(saved));
            }, []);

            // Save Game
            useEffect(() => {
                localStorage.setItem('cookie_rng_save', JSON.stringify(gameState));
            }, [gameState]);

            const handleRoll = () => {
                const newCookie = {
                    id: Date.now().toString(),
                    name: "Fresh Batch",
                    rarity: Rarity.COMMON,
                    baseValue: 1.5,
                    colorHex: '#D2691E'
                };
                setGameState(prev => ({
                    ...prev,
                    cookies: [...prev.cookies, newCookie],
                    activeCookieId: newCookie.id
                }));
            };

            const handleMainClick = () => {
                const activeCookie = gameState.cookies.find(c => c.id === gameState.activeCookieId);
                const mult = activeCookie ? activeCookie.baseValue : 1;
                const power = gameState.upgrades.clickPowerLevel * mult;
                setGameState(prev => ({ 
                    ...prev, 
                    bits: prev.bits + power,
                    totalBitsEarned: prev.totalBitsEarned + power 
                }));
            };

            return (
                <div className="min-h-screen bg-zinc-950 flex flex-col text-white">
                    {/* Header */}
                    <header className="p-6 flex justify-between items-center bg-zinc-900/50 backdrop-blur-md">
                        <div>
                            <h1 className="text-xl font-black text-amber-500 uppercase tracking-tighter">Cookie RNG</h1>
                            <p className="text-[10px] text-zinc-500 font-bold uppercase">Phase: {gameState.upgrades.luckLevel}</p>
                        </div>
                        <div className="bg-black/40 border border-white/10 px-4 py-2 rounded-xl flex items-center gap-2">
                            <Lucide.Zap size={16} className="text-amber-400" />
                            <span className="font-mono font-bold text-lg">{Math.floor(gameState.bits).toLocaleString()}</span>
                        </div>
                    </header>

                    {/* Viewport */}
                    <main className="flex-1 overflow-y-auto hide-scrollbar p-4">
                        {activeTab === 'roll' && (
                            <div className="flex flex-col items-center justify-center min-h-[60vh]">
                                <button onClick={handleMainClick} className="relative active:scale-90 transition-transform">
                                    <Lucide.Cookie size={180} className="text-amber-700 drop-shadow-[0_0_30px_rgba(180,83,9,0.3)]" />
                                </button>
                                <button onClick={handleRoll} className="mt-12 bg-amber-600 hover:bg-amber-500 px-8 py-3 rounded-full font-bold uppercase tracking-widest text-sm shadow-lg shadow-amber-900/20">
                                    Roll for Cookie (100 Bits)
                                </button>
                            </div>
                        )}

                        {activeTab === 'inventory' && (
                            <div className="grid grid-cols-2 gap-3">
                                {gameState.cookies.map(c => (
                                    <div key={c.id} className={`p-4 rounded-2xl border ${gameState.activeCookieId === c.id ? 'border-amber-500 bg-amber-500/10' : 'border-white/5 bg-zinc-900'}`}>
                                        <div className="w-8 h-8 rounded-full mb-2" style={{ backgroundColor: c.colorHex }}></div>
                                        <div className="text-xs font-bold truncate">{c.name}</div>
                                        <div className="text-[10px] opacity-50 uppercase">{c.rarity}</div>
                                        <button onClick={() => setGameState(p => ({...p, activeCookieId: c.id}))} className="mt-3 w-full text-[10px] font-bold bg-white/5 py-1 rounded-md">EQUIP</button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    {/* Navigation */}
                    <nav className="bg-zinc-900/90 backdrop-blur-xl border-t border-white/5 px-6 pt-4 pb-8 safe-bottom flex justify-between items-center">
                        <NavButton active={activeTab === 'roll'} icon={Lucide.Cookie} label="Roll" onClick={() => setActiveTab('roll')} />
                        <NavButton active={activeTab === 'inventory'} icon={Lucide.LayoutGrid} label="Stash" onClick={() => setActiveTab('inventory')} />
                        <NavButton active={activeTab === 'upgrades'} icon={Lucide.ArrowUpCircle} label="Upgrades" onClick={() => setActiveTab('upgrades')} />
                        <NavButton active={activeTab === 'shop'} icon={Lucide.ShoppingBag} label="Shop" onClick={() => setActiveTab('shop')} />
                    </nav>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
