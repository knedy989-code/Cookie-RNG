<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Cookie RNG: Infinite Crumb</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "lucide-react": "https://esm.sh/lucide-react@0.454.0"
      }
    }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111;
            color: #f3f4f6;
            margin: 0;
            overflow: hidden; /* Prevent scrolling on the body */
            height: 100vh;
            width: 100vw;
        }
        h1, h2, h3, .font-display { font-family: 'Fredoka', sans-serif; }
        
        /* Hide Toolbar / Fullscreen utility */
        :fullscreen { background-color: #111; }
        
        .cookie-spin { animation: spin-slow 20s linear infinite; }
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        
        /* Utility for No Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useCallback, useMemo } from 'react';
        import ReactDOM from 'react-dom';
        import * as Lucide from 'lucide-react';

        // --- Constants (Simplified for Single File) ---
        const RARITY_DURABILITY = { COMMON: 50, UNCOMMON: 100, RARE: 250, EPIC: 500, LEGENDARY: 1000, MYTHIC: 5000, DIVINE: 1000000 };
        const UPGRADE_COSTS = {
            clickPower: (lvl) => Math.floor(10 * Math.pow(1.5, lvl)),
            luck: (lvl) => Math.floor(100 * Math.pow(2.5, lvl)),
            autoClicker: (lvl) => Math.floor(50 * Math.pow(2, lvl)),
            ascension: (lvl) => 1000000 * (lvl + 1)
        };

        const INITIAL_STATE = {
            bits: 0,
            totalBitsEarned: 0,
            clickCount: 0,
            cookies: [],
            upgrades: { clickPowerLevel: 1, luckLevel: 0, autoClickerLevel: 0, ascensionLevel: 0 },
            activeEffects: { clickMultiplier: 1, clickMultiplierEndTime: 0, protectedClicks: 0 },
            unlockedRarities: [],
            activeCookieId: undefined,
            settings: { soundEnabled: true },
            cheatMode: false,
            chronoSpawnerUnlocked: false,
            claimedQuestIds: []
        };

        // --- Mock Components (Placeholders for original imports) ---
        const Placeholder = ({ name }) => (
            <div className="p-8 text-center border-2 border-dashed border-gray-800 rounded-xl text-gray-600">
                {name} component would render here. Ensure you include the logic from your sub-files.
            </div>
        );

        // --- Main App Logic ---
        const App = () => {
            const [gameState, setGameState] = useState(INITIAL_STATE);
            const [activeTab, setActiveTab] = useState('roll');
            const [toast, setToast] = useState(null);
            const [showSecretInput, setShowSecretInput] = useState(false);
            const [secretCodeInput, setSecretCodeInput] = useState('');

            // Fullscreen / Hide Toolbar Logic
            const enterFullscreen = () => {
                const elem = document.documentElement;
                if (elem.requestFullscreen) elem.requestFullscreen();
                else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
                else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
            };

            // Persistence
            useEffect(() => {
                const saved = localStorage.getItem('cookie_rng_save_v3');
                if (saved) setGameState(prev => ({ ...prev, ...JSON.parse(saved) }));
            }, []);

            useEffect(() => {
                localStorage.setItem('cookie_rng_save_v3', JSON.stringify(gameState));
            }, [gameState]);

            const handleCookieClick = () => {
                const power = gameState.upgrades.clickPowerLevel * gameState.activeEffects.clickMultiplier;
                setGameState(prev => ({
                    ...prev,
                    bits: prev.bits + power,
                    clickCount: prev.clickCount + 1,
                    totalBitsEarned: prev.totalBitsEarned + power
                }));
            };

            const toggleSound = () => {
                setGameState(prev => ({
                    ...prev,
                    settings: { ...prev.settings, soundEnabled: !prev.settings.soundEnabled }
                }));
            };

            return (
                <div className="flex flex-col md:flex-row h-screen w-full overflow-hidden bg-[#111]">
                    
                    {/* Sidebar / Clicker */}
                    <div className="w-full md:w-1/3 border-b md:border-b-0 md:border-r border-white/5 bg-[#161616] flex flex-col">
                        <div className="p-6 flex justify-between items-center">
                            <h1 onClick={enterFullscreen} className="text-xl font-display font-bold text-amber-500 cursor-pointer">Infinite Crumb</h1>
                            <button onClick={toggleSound} className="p-2 bg-gray-800 rounded-full">
                                {gameState.settings.soundEnabled ? <Lucide.Volume2 size={18}/> : <Lucide.VolumeX size={18}/>}
                            </button>
                        </div>
                        
                        <div className="flex-grow flex flex-col items-center justify-center p-4">
                            <div 
                                onClick={handleCookieClick}
                                className="w-48 h-48 bg-amber-800 rounded-full cursor-pointer shadow-[0_0_50px_rgba(217,119,6,0.2)] hover:scale-105 active:scale-95 transition-transform flex items-center justify-center border-8 border-amber-900/50"
                            >
                                <Lucide.Cookie size={80} className="text-amber-200" />
                            </div>
                            <div className="mt-8 text-center">
                                <div className="text-4xl font-bold text-white tracking-tighter">{Math.floor(gameState.bits).toLocaleString()}</div>
                                <div className="text-amber-500 font-mono text-sm uppercase tracking-widest">Cookie Bits</div>
                            </div>
                        </div>
                    </div>

                    {/* Main Content Area */}
                    <div className="w-full md:w-2/3 flex flex-col bg-[#111]">
                        <nav className="flex border-b border-white/5 bg-[#161616] no-scrollbar overflow-x-auto">
                            {[
                                { id: 'roll', icon: Lucide.Cookie, label: 'Summon' },
                                { id: 'inventory', icon: Lucide.LayoutGrid, label: 'Inv' },
                                { id: 'upgrades', icon: Lucide.ArrowUpCircle, label: 'Tech' },
                                { id: 'shop', icon: Lucide.ShoppingBag, label: 'Shop' }
                            ].map(tab => (
                                <button 
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex-1 py-4 px-4 flex items-center justify-center gap-2 text-xs font-bold uppercase transition-all ${activeTab === tab.id ? 'text-amber-500 border-b-2 border-amber-500 bg-white/5' : 'text-gray-500'}`}
                                >
                                    <tab.icon size={16} /> {tab.label}
                                </button>
                            ))}
                        </nav>

                        <div className="flex-grow p-6 overflow-y-auto">
                            <h2 className="text-2xl font-bold mb-4 capitalize">{activeTab}</h2>
                            <Placeholder name={activeTab} />
                            
                            <div className="mt-8 p-4 bg-white/5 rounded-lg border border-white/10">
                                <p className="text-gray-400 text-sm italic">
                                    Tip: Tap the "Infinite Crumb" logo to attempt to enter Fullscreen mode and hide toolbars.
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Secret Access */}
                    <button 
                        onClick={() => setShowSecretInput(true)}
                        className="fixed right-0 top-1/2 -translate-y-1/2 w-2 h-16 bg-white/10 hover:bg-red-500/20 transition-colors"
                    />
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
